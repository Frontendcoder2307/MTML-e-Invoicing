<div class="container" id="invoice">
    <div class="row my-3 justify-content-center">
        <div class="col-10">
            <div class="border border-secondary-subtle rounded-4 overflow-hidden mt-3" id="content">
            
                <!-- Header with Brand Color -->
            <!-- Company Header Section -->
            <div class="container py-2 border-bottom">
                <div class="row align-items-center text-center text-md-start">
            
                    <!-- Company Logo (Left on large, top on small) -->
                    <div class="col-12 col-md-3 mb-1 mb-md-0">
                        <img src="/assets/images/MTML.jpg" alt="Company Logo" class="img-fluid" style="max-height: 60px;">
                    </div>
            
                    <!-- Company Info (Centered) -->
                    <div class="col-12 col-md-6 text-center">
                        <h5 class="fw-bold mb-1">MAHANAGAR TELEPHONE (MAURITIUS) LTD</h5>
                        <p class="mb-1">63, Cybercity, Ebene, Mauritius</p>
                        <p class="mb-0 small">
                            <strong>Helpdesk:</strong> 8960 &nbsp; | &nbsp;
                            <strong>Phone:</strong> +230 5294 3333 &nbsp; | &nbsp;
                            <strong>Web:</strong> <a href="http://www.chili.mu" target="_blank">www.chili.mu</a>
                        </p>
                    </div>
            
                    <!-- Optional QR/Stamp Image (Right) -->
                    <div class="col-12 col-md-3 mt-1 mt-md-0 text-md-end">
                        <img src="/assets/images/chililogo.jpg" alt="QR Code" class="img-fluid" style="max-height: 60px;">
                    </div>
                </div>
            </div>
              
                
                <!-- Invoice Info Section -->
                <!-- <div class="text-white p-4 d-flex justify-content-between align-items-center">
                    <div>
                        <h3 class="m-0 fw-bold text-dark">INVOICE No.</h3>
                        <h4 class="d-block text-dark">#{{ invoice.invoiceId }}</h4>
                    </div>
                    <div>
                        <img src="/assets/images/ChiLi-logo.svg" alt="ChiLi Logo" height="80" class="bg-FF0088 p-2 rounded-3">
                    </div>
                </div> -->
  
            
                <div class="p-2 text-dark">
            
                    <!-- Seller & Buyer Info -->
                    <div class="row ">
                        <div class="col-md-6">
                            <h5 class="fw-semibold">{{ invoice.sellerName }}</h5>
                            <div class="small text-muted">
                                <p class="mb-1">{{ invoice.sellerbusinessAddr }}</p>
                                <p class="mb-1">BRN: {{ invoice.sellerBrn }}</p>
                                <p class="mb-1">TAN: {{ invoice.sellerTan }}</p>
                            </div>
                        </div>
                        <div class="col-md-6 text-md-end">
                            <p class="mb-1"><strong>Issued:</strong> {{ invoice.dateTimeInvoiceIssued.split(' ')[0] }}</p>
                            <p class="mb-1"><strong>Invoice ID:</strong> {{invoice.invoiceIndentifier}}</p>
                            <p class="mb-1"><strong>Transaction:</strong> {{ invoice.txnType }}</p>
                            <p class="mb-1"><strong>IRN:</strong> {{ IRN || '' }}</p>
                            <p class="mb-1"><strong>Status:</strong>
                                <span class="badge rounded-pill text-bg-success ms-3"
                                    *ngIf="invoice.status=='SUCCESS'">{{invoice.status}}
                                </span>
                                <span class="badge rounded-pill text-bg-warning"
                                    *ngIf="invoice.status=='PENDING'">{{invoice.status}}
                                </span>
                                <span class="badge rounded-pill text-bg-danger"
                                    *ngIf="invoice.status=='FAILED' || invoice.status=='REJECTED'">{{invoice.status}}
                                </span>
                            </p>
                        </div>
                    </div>
            
                    <!-- Buyer Info -->
                    <div class="row mb-2">
                        <div class="col-md-6">
                            <h6 class="fw-bold">Bill To</h6>
                            <p class="mb-1">{{ invoice.buyerName }}</p>
                            <ng-container *ngIf="invoice.buyerbusinessAddr !='N/A' || invoice.buyerbusinessAddr ">
                            <p class="text-muted small mb-1">{{ invoice.buyerbusinessAddr }}</p>
                            </ng-container>

                            <p class="text-muted small mb-1">Type: {{ invoice.buyerType }}</p>

                            <ng-container *ngIf="invoice.buyerBrn">
                                <p class="text-muted small mb-1">BRN: {{ invoice.buyerBrn }}</p>
                            </ng-container>
            
                            <ng-container *ngIf="invoice.buyerTan">
                                <p class="text-muted small mb-1">VAT No: {{ invoice.buyerTan }}</p>
                            </ng-container>
            
                            <ng-container *ngIf="invoice.buyerNic">
                                <p class="text-muted small mb-0">NIC: {{ invoice.buyerNic }}</p>
                            </ng-container>

                            <ng-container *ngIf="invoice.buyerMsisdn && invoice.buyerMsisdn.length>=8">
                                <p class="text-muted small mb-0">Contact Number: {{ invoice.buyerMsisdn }}</p>
                            </ng-container>
                        </div>
                    </div>
            
                    <!-- Product Table -->
                    <div class="table-responsive mb-4">
                        <table class="table table-bordered rounded-3 overflow-hidden">
                            <thead >
                                <tr>
                                    <th style="color: #121821 !important">#</th>
                                    <th style="color: #121821 !important">Item Type</th>
                                    <th style="color: #121821 !important">Description</th>
                                    <th style="color: #121821 !important" class="text-center">Qty</th>
                                    <th style="color: #121821 !important" class="text-end">Unit Price <small>(MUR)</small></th>
                                    <th style="color: #121821 !important" class="text-end">Total <small>(MUR)</small></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let p of invoice.products; let i = index">
                                    <td style="background-color: #FEFEFE;">{{ i + 1 }}</td>
                                    <td style="background-color: #FEFEFE;">{{ p.itemDesc.split("-")[0].split(' ')[0]+" "+p.itemDesc.split("-")[0].split(' ')[1]}}</td>
                                    <td style="background-color: #FEFEFE;">{{ p.itemDesc.split('-')[1] }}</td>
                                    <td class="text-center" style="background-color: #FEFEFE;">{{ p.quantity }}</td>
                                    <td class="text-end" style="background-color: #FEFEFE;">{{ p.unitPrice | number:'1.2-2' }}</td>
                                    <td class="text-end" style="background-color: #FEFEFE;">{{ p.quantity * p.unitPrice | number:'1.2-2' }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Calculation Table -->
                    <div class="table-responsive mb-4">
                        <table class="table table-bordered rounded-3 overflow-hidden text-center">
                            <thead>
                                <tr >
                                    <th style="color: #121821 !important">InvoiceTotal <small>(MUR)</small></th>
                                    <th style="color: #121821 !important">Total VAT <small>(MUR)</small></th>
                                    <th style="color: #121821 !important">Discount <small>(MUR)</small></th>
                                    <th style="color: #121821 !important">Previous Balance <small>(MUR)</small></th>
                                    <th style="color: #121821 !important">Total <small>(MUR)</small></th>
                                    <th style="color: #121821 !important" >Paid (MUR)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr >
                                    <td style="background-color: #FEFEFE;">{{ InvoiceTotal | number:'1.2-2'}}</td>
                                    <td style="background-color: #FEFEFE;"> {{ invoice.totalVatAmount| number:'1.2-2' }}</td>
                                    <td style="background-color: #FEFEFE;"> - {{ invoice.discountTotalAmount || 0.00 | number:'1.2-2' }}</td>
                                    <td style="background-color: #FEFEFE;"> {{ previousBalance| number:'1.2-2' }}</td>
                                    <td style="background-color: #FEFEFE;"> {{ invoice.invoiceTotal |number:'1.2-2' }}</td>
                                    <td  style="background-color: #FEFEFE;"> {{ invoice.totalAmtPaid | number:'1.2-2'}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

            
                    <!-- Totals Section -->
                    <div class="row justify-content-end">
                        <div class="col-12 text-start ">
                            <div class="text-center">
                                <ng-container *ngIf="QRCode !=''">
                                    <img [src]=QRCode alt="QR Code" width="120">
                                    <p class="text-muted small">Generated by MRA</p>
                                </ng-container>
                                <ng-template *ngIf="QRCode ==''">
                                    <p class="text-muted fst-italic">QR Code not available.</p>
                                </ng-template>
                            </div>
                        </div>
            
            
                        <!-- <div class="col-md-5">
                            <table class="table table-borderless">
                                <tr>
                                    <td style="background-color: #FEFEFE;">InvoiceTotal:</td>
                                    <td class="text-end " style="background-color: #FEFEFE;">MUR {{ InvoiceTotal | number:'1.2-2'}}
                                    </td>
                                </tr>
            
                                <tr>
                                    <td style="background-color: #FEFEFE;">Discount: <b>(-)</b></td>
                                    <td class="text-end border-bottom" style="background-color: #FEFEFE;">MUR {{
                                        invoice.discountTotalAmount || 0.00 | number:'1.2-2' }}</td>
                                </tr>
                                <tr>
                                    <td style="background-color: #FEFEFE;">Subtotal:</td>
                                    <td class="text-end" style="background-color: #FEFEFE;">MUR {{ invoice.totalAmtWoVatMur }}</td>
                                </tr>
                                <tr *ngIf="invoice.totalVatAmount!=0">
                                    <td style="background-color: #FEFEFE;">VAT (15%): <b>(+)</b></td>
                                    <td class="text-end " style="background-color: #FEFEFE;">MUR {{
                                        invoice.totalVatAmount| number:'1.2-2' }}</td>
                                </tr>
                                <tr *ngIf="previousBalance>0 || previousBalance!=0  ">
                                    <td style="background-color: #FEFEFE;">Previous Balance: <b>(+)</b></td>
                                    <td class="text-end " style="background-color: #FEFEFE;">MUR {{
                                        previousBalance| number:'1.2-2' }}</td>
                                </tr>
                                <tr *ngIf="roundingOffamt>=0">
                                    <td style="background-color: #FEFEFE;">Round Off: <b>(-)</b></td>
                                    <td class="text-end " style="background-color: #FEFEFE;">MUR {{
                                        roundingOffamt| number:'1.2-2' }}</td>
                                </tr>
                                
                                <tr class="fw-bold">
                                    <td style="color: #FF0088 !important; background-color: #FEFEFE;">Total:</td>
                                    <td class="text-end border-top" style="color: #FF0088 !important; background-color: #FEFEFE;">MUR {{
                                        invoice.invoiceTotal |number:'1.2-2' }}</td>
                                </tr>
                                <tr class="fw-bold ">
                                    <td style="color: #FF0088 !important;background-color: #FEFEFE;">Paid:</td>
                                    <td class="text-end" style="color: #FF0088 !important;background-color: #FEFEFE;">MUR {{
                                        invoice.totalAmtPaid | number:'1.2-2'}}</td>
                                </tr>
                            </table>
                        </div> -->
                    </div>
            
                    <!-- QR Code -->
                    <!-- <div class="text-center my-4">
                                            <ng-container *ngIf="QRCode !=''">
                                                <img [src]=QRCode alt="QR Code" width="120">
                                                <p class="text-muted small">Generated by MRA</p>
                                            </ng-container>
                                            <ng-template *ngIf="QRCode ==''">
                                                <p class="text-muted fst-italic">QR Code not available.</p>
                                            </ng-template>
                                        </div> -->
            
                    <!-- Footer Notes -->
                    <div class="border-top pt-3 text-muted small">
                        <p><strong>Note:</strong> {{ invoice.reasonStated || 'Thank you for your business.' }}</p>
                        <p class="mb-0">Generated on {{ invoice.processingDateTime.split('T')[0] }}</p>
                    </div>
            
            
                </div>
                </div>
        </div>
        
    </div>
    <!-- Action Buttons -->
    <div class="text-end my-4 no-print" >
        <button class="btn btn-outline-warning me-2" (click)="printInvoice()">🖨️ Print</button>
        <button class="btn btn-outline-warning me-2" data-bs-toggle="modal" data-bs-target="#sendSMSModal">📲 Send SMS</button>    
        <button class="btn btn-outline-warning me-2" (click)="goBack()">Back</button>
        <!-- <button class="btn btn-outline-warning me-2" (click)="makePDF()">⬇️ Download PDF</button> -->
    </div>
</div>



<!-- Modal -->
<div class="modal fade" id="sendSMSModal" tabindex="-1" aria-labelledby="sendSMSModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">               
                <div class="row">
                    <div class="col-md-12 mt-3 form-group">
                        <h4 style="color: #FF0088;">Mobile Number</h4>
                        <input type="tel" class="form-control fs-3" [(ngModel)]="mobileNumber" maxlength="8" minlength="8" />                                                
                    </div>
                    <div class="col-md-6 text-center mt-4">
                        <button type="button" class="btn btn-outline-danger w-100 fs-5" data-bs-dismiss="modal">Cancel</button>
                    </div>
                    <div class="col-md-6 text-center mt-4">
                        <button type="submit" class="btn btn-outline-success w-100 fs-5" (click)="sendSMS()">Send</button>
                    </div>                    
                </div>
            </div>
        </div>
    </div>
    </div>